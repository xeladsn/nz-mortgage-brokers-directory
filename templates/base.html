<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Find trusted mortgage brokers across New Zealand. Comprehensive directory of licensed mortgage advisers helping Kiwis find the best home loans.{% endblock %}">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="{{ request.url }}" />
    <title>{% block title %}NZ Mortgage Brokers Directory{% endblock %} | Find Trusted Mortgage Advisers</title>
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ self.meta_description() }}{% endblock %}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:site_name" content="NZ Mortgage Brokers Directory">
    {% block extra_meta %}{% endblock %}
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    {% block extra_css %}{% endblock %}
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "NZ Mortgage Brokers Directory",
        "url": "{{ request.url_root }}",
        "description": "Comprehensive directory of licensed mortgage brokers in New Zealand",
        "address": {
            "@type": "PostalAddress",
            "addressCountry": "NZ"
        }
    }
    </script>
    {% block extra_structured_data %}{% endblock %}
    
    <!-- Heap Analytics Script - Only in Production -->
    {% if config.ENV == 'production' %}
    <script type="text/javascript">
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a);for(var n=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],o=0;o<p.length;o++)heap[p[o]]=n(p[o])};   
      heap.load("2916717028");
    </script>
    {% else %}
    <!-- Heap Analytics disabled in development environment -->
    {% endif %}
    
    {% block extra_head_scripts %}{% endblock %}
</head>
<body>
    {% block header %}
        {% include 'components/header.html' %}
    {% endblock %}

    <div class="container">
        <div class="content-wrapper">
            {% block main_content %}
                <main>
                    {% block content %}{% endblock %}
                </main>
            {% endblock %}
        </div>
        
        {% block sidebar %}
        <div class="bottom-content">
            <aside>
                {% block aside_content %}{% endblock %}
            </aside>
        </div>
        {% endblock %}
    </div>

    {% block footer %}
    <footer class="footer mt-auto py-3 bg-light">
        <div class="container text-center">
            <span class="text-muted">&copy; 2025 Kiwi Homebuyers. All rights reserved.</span>
        </div>
    </footer>
    {% endblock %}

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
